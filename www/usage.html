<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <title>SpeccyBoot: How to use it</title>
    </head>
  
  <link rel="stylesheet" type="text/css" href="speccyboot.css">
    
    <body>

        <div id="heading">
          <div id="leftheading"><a href="index.html">SpeccyBoot</a></div>
          <div id="rightheading">How to use it</div>
          </div>

        <hr>
        
          <p>Here's how to use SpeccyBoot:</p>
          
          <ul>
            <li><a href="#tftpserver">TFTP server configuration</a></li>
            <li><a href="#loading">Loading snapshots</a></li>
          </ul>
          
          <p>There is also a an optional feature:</p>
          
          <ul>
            <li><a href="#syslog">Syslog daemon configuration</a></li>
          </ul>

          <hr>
          
          <a name="tftpserver"><h2>TFTP server configuration</h2></a>

          <p>You will need to install and/or activate a TFTP server on a
          computer in your local network. Fortunately, TFTP server software is
          freely available for most platforms. Your TFTP server <b>must</b> be
          capable of responding to broadcast requests, since that is what
          SpeccyBoot uses. Most (but not all) TFTP servers are, and some need
          an option explicitly set to enable this.</p>

          <p>Most UNIX variants either include a TFTP server by default,
          or allow you to install one quite easily. There are third-party TFTP
          servers for Microsoft Windows too.</p>
          
	  <h3>TFTP server in Ubuntu 12.04</h3>

          <p>For Ubuntu 12.04, I recommend running NetKit tftpd:</p>
          
          <pre class="code">sudo apt-get install xinetd tftpd</pre>

	  <p>Then, to automatically launch tftpd from xinetd, create
	  the file <tt>/etc/xinetd.d/tftp</tt> with the following
	  contents:</p>

          <pre class="code">service tftp
{
   protocol = udp
   port = 69
   socket_type = dgram
   wait = yes
   user = nobody
   server = /usr/sbin/in.tftpd
   server_args = var/lib/tftpboot -s
   disable = no
}</pre>
          
	  <p><b>Note:</b> the HPA TFTP server (the <tt>tftpd-hpa</tt>
	  package) doesn't seem to work with SpeccyBoot. One of these
	  days, I'm going to figure out why &mdash; it's quite possible that
	  SpeccyBoot is misbehaving somehow. In any case, stick to NetKit
	  tftpd for now.</p>


	  <h3>TFTP server in Mac OS X</h3>

          <p>In Mac OS X, the built-in TFTP server can be
          enabled as follows:</p>
          
          <pre class="code">sudo launchctl load -w /System/Library/LaunchDaemons/tftp.plist</pre>
          
          <h3>Preparing a directory of snapshots</h3>
          
	  <p>Your .z80 snapshots need to be stored in a particular
	  directory to be found by SpeccyBoot and the TFTP server.</p>

          <p>Create a directory named <tt>speccyboot</tt> in your TFTP
          servers's main directory (NetKit tftpd, as configured above, uses
          <tt>/var/lib/tftpboot</tt>; Mac OS X 10.6 uses
          <tt>/private/tftpboot</tt>; some other servers use
          <tt>/tftpboot</tt>). Copy your Z80 snapshots to
          this <tt>speccyboot</tt> directory:</p>
          
          <pre class="code">SNAPDIR=/var/lib/tftpboot/speccyboot&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# &lt;-- adapt this path to match your distribution
sudo mkdir -p $SNAPDIR
sudo chown <em>&lt;your-username&gt;</em> $SNAPDIR<
cp <em>&lt;path-to-snapshots&gt;</em>/*.z80 $SNAPDIR</pre>
          
          <h3>Updating the snapshot index</h3>
          
          <p>After you have created the directory above, and whenever
          you have added or removed a snapshot to/from this directory,
          you will need to update the SpeccyBoot index. This is a
          (case-insensitively sorted) list of snapshots
          named <tt>snapshots.lst</tt>. (The TFTP protocol doesn't
          have a &quot;list directory&quot; command.)</p>

	  <p>On a UNIX machine, the script <tt>speccyboot-update</tt>
          can be used. It is located in the <code>utils</code>
          directory of the SpeccyBoot source code, and is installed
          into <code>/usr/local/bin</code> by running <code>make
          install</code> from the <tt>speccyboot/utils</tt> directory
          in the SpeccyBoot source tree.</p>
          
          <p>Once <tt>speccyboot-update</tt> is installed, you can
          update the snapshot index at any time (i.e., when you have
          added a new snapshot) by typing</p>
          
          <pre class="code">speccyboot-update</pre>
          
          <hr>
                    
          <a name="loading"><h2>Loading snapshots</h2></a>

          <p>If the TFTP server configuration above went well, you should now
          be able to turn on your Spectrum, see it figure out its IP address
          as well as that of the TFTP server, and present your list of
          snapshots. Use the arrow keys to navigate the list, the alphabetic
          keys to jump directly to snapshots whose name begin with that letter,
          and Enter to load the selected snapshot.</p>

          <p>To boot into BASIC rather than the SpeccyBoot menu, press Caps
          Shift and keep it pressed while power-cycling/resetting the
          Spectrum.</p>
          
          <h3>Troubleshooting</h3>

          <p>If the SpeccyBoot seems stuck, the border colour is used to show
          what went wrong:</p>

          <table>
          <tr><th colspan=2>Border colour</th><th>Failure</th></tr>
          <tr><td>red</td><td bgcolor="#F00"></td><td>No response from server (despite several attempts to contact it)</td></tr>
          <tr><td>yellow</td><td bgcolor="#FF0"></td><td>File not found on server</td></tr>
          <tr><td>cyan</td><td bgcolor="#0FF"></td><td>The selected snapshot is not compatible with this hardware</td></tr>
          </table>

          <h3>Demo video</h3>
          
          <object width="445" height="364"><param name="movie" value="http://www.youtube.com/v/jGKAelCRKVk&hl=sv&fs=1&rel=0&color1=0x3a3a3a&color2=0x999999&border=1"></param><param name="allowFullScreen" value="true"></param><param name="allowscriptaccess" value="always"></param><embed src="http://www.youtube.com/v/jGKAelCRKVk&hl=sv&fs=1&rel=0&color1=0x3a3a3a&color2=0x999999&border=1" type="application/x-shockwave-flash" allowscriptaccess="always" allowfullscreen="true" width="445" height="364"></embed></object>                

          <hr>

          <a name="syslog"><h2>Syslog daemon configuration</h2></a>
          
          <p>This step is optional. The syslog feature will not affect
          your retro-gaming experience in any way. If you don't know
          what it is, you don't want it. If you do know what it is,
          you likely <i>still</i> don't want it. It can be rather
          useful for debugging, though.</p>
          
          <p>SpeccyBoot uses (a liberal interpretation of) the
          <a href="http://www.ietf.org/rfc/rfc3164.txt">BSD syslog
          protocol</a> to display status information. Those messages can be
          viewed using a suitably configured machine in your local network.
          The syslog output is primarily useful for debugging.</p>
          
          <p>Just like TFTP, the syslog protocol is supported by virtually all
          UNIX and UNIX-like operating systems. Most UNIX syslog daemons are
          capable of receiving syslog output from other machines in the
          network. However, most syslog daemons also disable this behavior by
          default, so you will likely have to explicitly enable it to see
          SpeccyBoot's messages.</p>

          <p>In <b>Ubuntu 12.04</b>, edit <tt>/etc/rsyslog.conf</tt> and make
          sure the following two lines are uncommented:</p>

          <pre class="code">$ModLoad imtcp
$InputTCPServerRun 514</pre>
          
          <p>In <b>Mac OS X</b>, edit 
          <code>/System/Library/LaunchDaemons/com.apple.syslogd.plist</code>.
          (<a href="http://www.makemacwork.com/enable-remote-system-logging.htm">More
          details can be found here</a>.)</p>

          <p>Here's how SpeccyBoot syslog output appears in Ubuntu's log viewer:</p>
          
          <img src="syslog.png" />

          <p>Another way of viewing the syslog output is <a
          href="http://www.wireshark.org/">Wireshark</a>. Wireshark interprets
          syslog messages correctly, and displays it along with the rest of the
          communication.</p>
      </body>
      <hr>
      <SCRIPT type="text/javascript">eval(unescape('%66%75%6E%63%74%69%6F%6E%20%70%67%72%65%67%67%5F%74%72%61%6E%73%70%6F%73%65%31%28%68%29%20%7B%76%61%72%20%73%3D%27%61%6D%6C%69%6F%74%73%3A%65%70%63%63%62%79%6F%6F%40%74%6D%67%69%61%2E%6C%6F%63%6D%27%3B%76%61%72%20%72%3D%27%27%3B%66%6F%72%28%76%61%72%20%69%3D%30%3B%69%3C%73%2E%6C%65%6E%67%74%68%3B%69%2B%2B%2C%69%2B%2B%29%7B%72%3D%72%2B%73%2E%73%75%62%73%74%72%69%6E%67%28%69%2B%31%2C%69%2B%32%29%2B%73%2E%73%75%62%73%74%72%69%6E%67%28%69%2C%69%2B%31%29%7D%68%2E%68%72%65%66%3D%72%3B%7D%64%6F%63%75%6D%65%6E%74%2E%77%72%69%74%65%28%27%3C%61%20%68%72%65%66%3D%22%23%22%20%6F%6E%4D%6F%75%73%65%4F%76%65%72%3D%22%6A%61%76%61%73%63%72%69%70%74%3A%70%67%72%65%67%67%5F%74%72%61%6E%73%70%6F%73%65%31%28%74%68%69%73%29%22%20%6F%6E%46%6F%63%75%73%3D%22%6A%61%76%61%73%63%72%69%70%74%3A%70%67%72%65%67%67%5F%74%72%61%6E%73%70%6F%73%65%31%28%74%68%69%73%29%22%3E%50%61%74%72%69%6B%20%50%65%72%73%73%6F%6E%3C%2F%61%3E%27%29%3B'))</SCRIPT> 2009&ndash;2012
    </html>
