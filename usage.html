<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Inconsolata&family=Noto+Sans:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="speccyboot.css">
  <title>SpeccyBoot: How to use it</title>
</head>

<body>

  <div id="content">

    <div id="heading">
      <div id="leftheading"><a href="index.html"><img id="logo" src="speccyboot.png" /></a></div>
      <div id="rightheading">How to use it</div>
    </div>

    <p>Here's how to use SpeccyBoot:</p>

    <ul>
      <li><a href="#tftpserver">BOOTP &amp; TFTP server configuration</a></li>
      <li><a href="#loading">Loading snapshots</a></li>
    </ul>

    <hr>

    <a name="tftpserver"><h2>BOOTP &amp; TFTP server configuration</h2></a>

    <p>You will need to install and/or activate servers for BOOTP and TFTP on a
      computer in your local network. BOOTP/TFTP server software is
      freely available for most platforms.</p>

    <p>Most UNIX variants either include a TFTP server by default,
      or allow you to install one quite easily. There are third-party TFTP
      servers for Microsoft Windows too.</p>

    <h3>BOOTP &amp; TFTP server in Ubuntu 20.04</h3>

    <p>For Ubuntu 20.04, I recommend running <code>dnsmasq</code> (which handles both BOOTP and TFTP).</p>

    <ul>
      <li>Install <code>dnsmasq</code>: <pre class="code">sudo apt install dnsmasq</pre>

        <p>(You may get an error message about <code>dnsmasq</code> being unable
          to start, due the DNS port being busy. Don't worry: the configuration below fixes this.)</p>
      </li>
      <li>Ensure there is a directory for the TFTP server:
        <pre class="code">sudo mkdir -p /var/tftp</pre>
      </li>
      <li>Edit <code>/etc/dnsmasq.conf</code> to something like the following:
        <pre class="code">port=0  <span class="scriptcomment"># disable dnsmasq's DNS (SpeccyBoot won't use it anyway)</span>

<span class="scriptcomment"># Set aside this range for static assignments</span>
dhcp-range=192.168.82.0,static
dhcp-authoritative

<span class="scriptcomment"># Assign a fixed IP address to SpeccyBoot's MAC address.
# (If this dnsmasq.conf file doesn't have any other dhcp-range or dhcp-host
# entries, no other BOOTP/DHCP requests are accidentally replied to.)</span>
dhcp-host=4e:23:e7:1b:7a:b3,192.168.82.48,infinite

<span class="scriptcomment"># Example:
# point SpeccyBoot to another server for TFTP. Note that no boot file name
# is given here (hence the comma before the IP address). If a boot file name
# is given, it is assumed to be a snapshot and loaded immediately (no menu).
# dhcp-boot=,192.168.123.234</span>

<span class="scriptcomment"># Example:
# set SpeccyBoot to always load the same snapshot (no menu).
# dhcp-boot=Arkanoid.z80</span>

enable-tftp
tftp-root=/var/tftp</pre>
      </li>
    </ul>

    <h3>Preparing a directory of snapshots</h3>

    <p>Your .z80 snapshots need to be made accessible to your TFTP server.
      Different TFTP servers use different directories, so check your documentation.
      (In the <span class="code">dnsmasq</span> example
      configuration above, this directory is <span class="code">/var/tftp</span>;
      other TFTP servers likely use something else.)
    </p>
    <p>
      Copy your .z80 snapshots to
      this directory:</p>

    <pre class="code">SNAPDIR=/var/tftp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="scriptcomment"># &lt;-- adapt this path to match your setup</span>
sudo mkdir -p $SNAPDIR
sudo cp <span class="scriptcomment">&lt;path-to-snapshots&gt;</span>/*.z80 $SNAPDIR</pre>

    <h3>Updating the snapshot index</h3>

    <p>After you have created the directory above, and whenever
    you add or remove a snapshot to/from this directory,
    you will need to update the SpeccyBoot binary <code>menu.bin</code>.
    (This is a menu application combined with a
    list of snapshots, and is required for snapshot loading to work.)

    <p>The Python script <span class="code">speccyboot-update</span>
    generates a <code>menu.bin</code> file for you. It is located in the <code>utils</code>
    directory of the SpeccyBoot source code, and is installed
    into <code>/usr/local/bin</code> by running <code>make
    install</code> from the <span class="code">speccyboot/utils</span> directory
    in the SpeccyBoot source tree.</p>

    <p>Once <span class="code">speccyboot-update</span> is installed, you can
    update the snapshot index at any time (such as when you have
    added a new snapshot to your TFTP directory) by typing</p>

    <pre class="code">sudo speccyboot-update</pre>

    <hr>

    <a name="loading"><h2>Loading snapshots</h2></a>

    <p>If the TFTP server configuration above went well, you should now
    be able to turn on your Spectrum, see it figure out its IP address
    as well as that of the TFTP server, and present your list of
    snapshots. Use the arrow keys to navigate the list, the alphabetic
    keys to jump directly to snapshots whose name begin with that letter,
    and Enter to load the selected snapshot.</p>

    <p>To boot into BASIC rather than the SpeccyBoot menu, press Caps
    Shift and keep it pressed while power-cycling/resetting the
    Spectrum.</p>

    <h3>Troubleshooting</h3>

    <p>If the SpeccyBoot seems stuck, the border colour should give a hint as to
    what went wrong:</p>

    <table id="errortable">
      <tr>
        <th>Border&nbsp;colour</th><th>Error</th><th>Explanation</th><th>Remedy</th>
      </tr>
      <tr>
        <td><div style="background-color:#f00;color:#fff">red</div></td>
        <td>wrong version for <code>menu.bin</code></td>
        <td>The menu binary <code>menu.bin</code> is incompatible with the SpeccyBoot firmware version. The firmware version is displayed on screen.</td>
        <td>
          Update the SpeccyBoot firmware and/or the Linux-side software (<code style="padding:0">speccyboot-update</code>) and ensure both are the same version.
        </td>
      </tr>
      <tr>
        <td><div style="background-color:#ff0">yellow</div></td>
        <td>file not found</td>
        <td>The TFTP server responded with a <code style="padding:0">TFTP ERROR</code>. This usually means the requested file could not be found on the server.</td>
        <td>
          Check your TFTP configuration and re-run <code style="padding:0">speccyboot-update</code>.
        </td>
      </tr>
      <tr>
        <td><div style="background-color:#00f;color:#fff">blue</div></td>
        <td>communication time-out</td>
        <td>
          <p>
            The border is set to blue whenever a packet is re-transmitted,
            so short moments with a blue border are perfectly normal.
          </p>
          <p>
            However, if SpeccyBoot gets <b>stuck</b> with a blue border it is likely
            due to a missing (or faulty) server response:
          </p>
          <ul style="margin-bottom:0;padding:0 0 0 0.5rem">
            <li>If all you see is a flashing cursor on a blank screen, BOOTP communication has failed.</li>
            <li>If you see two IP addresses on screen (local+server) and a flashing <code style="background-color:#0f0;color:#000">S</code>, TFTP communication has failed.</li>
          </ul>
</p>        </td>
        <td>
          Check your <a href="#tftpserver">BOOTP and/or TFTP server configuration</a>.
          <a href="https://www.wireshark.org/">Wireshark</a> can be useful for determining what's gone wrong.
        </td>
      </tr>
      <tr>
        <td><div style="background-color:#000;color:#fff">black</div></td>
        <td>hardware failure</td>
        <td>The ENC28J60 controller does not seem to respond to SPI communication.</td>
        <td>Check your SpeccyBoot hardware.</td>
      </tr>
    </table>

    <div class="footer">
      <SCRIPT type="text/javascript">eval(unescape('%66%75%6E%63%74%69%6F%6E%20%70%67%72%65%67%67%5F%74%72%61%6E%73%70%6F%73%65%31%28%68%29%20%7B%76%61%72%20%73%3D%27%61%6D%6C%69%6F%74%73%3A%65%70%63%63%62%79%6F%6F%40%74%6D%67%69%61%2E%6C%6F%63%6D%27%3B%76%61%72%20%72%3D%27%27%3B%66%6F%72%28%76%61%72%20%69%3D%30%3B%69%3C%73%2E%6C%65%6E%67%74%68%3B%69%2B%2B%2C%69%2B%2B%29%7B%72%3D%72%2B%73%2E%73%75%62%73%74%72%69%6E%67%28%69%2B%31%2C%69%2B%32%29%2B%73%2E%73%75%62%73%74%72%69%6E%67%28%69%2C%69%2B%31%29%7D%68%2E%68%72%65%66%3D%72%3B%7D%64%6F%63%75%6D%65%6E%74%2E%77%72%69%74%65%28%27%3C%61%20%68%72%65%66%3D%22%23%22%20%6F%6E%4D%6F%75%73%65%4F%76%65%72%3D%22%6A%61%76%61%73%63%72%69%70%74%3A%70%67%72%65%67%67%5F%74%72%61%6E%73%70%6F%73%65%31%28%74%68%69%73%29%22%20%6F%6E%46%6F%63%75%73%3D%22%6A%61%76%61%73%63%72%69%70%74%3A%70%67%72%65%67%67%5F%74%72%61%6E%73%70%6F%73%65%31%28%74%68%69%73%29%22%3E%50%61%74%72%69%6B%20%50%65%72%73%73%6F%6E%3C%2F%61%3E%27%29%3B'))</SCRIPT>
    </div>
  </div>
  </body>
</html>
