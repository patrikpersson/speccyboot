<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Inconsolata&family=Noto+Sans:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="speccyboot.css">
    <title>SpeccyBoot: How to build one yourself</title>
  </head>

    <body>
      <div id="content">

        <div id="heading">
          <div id="leftheading"><a href="index.html"><img id="logo" src="speccyboot.png" /></a></div>
          <div id="rightheading">How to build one yourself</div>
        </div>

        <p id="warning"><b>NOTE:</b> I assume <b>no responsibility</b> for what happens if you
        connect this to your Spectrum. This design works well for me, but
        be aware that a mistake (yours or mine) may destroy your
        dear Spectrum. <b>You have been warned!</b></p>

        <p>There are three steps to building a SpeccyBoot: building the
        hardware, building the firmware, and getting the firmware onto
        the hardware.</p>

        <ul>
          <li><a href="#hardware">Building the hardware</a></li>
          <li><a href="#software">Building the firmware</a></li>
          <li><a href="#install">Installing the firmware on the device</a></li>
        </ul>

        <hr>

        <a name="hardware">
          <h2>Building the hardware</h2>
          </a>

        <p>The schematic design is <a href="schematic.png">available
        here</a>.</p>

        <p>I built the device on a basic lab board. I'm not much of a soldering
        wizard, but you should probably have some rudimentary soldering
        experience to pull this off. A few notes on the design:</p>

        <ul>

          <li>
            <p>I chose to use the
            <a href="https://www.olimex.com/Products/Modules/Ethernet/ENC28J60-H/">Olimex
            ENC28J60-H development board</a> for the Ethernet subsystem. This is
            not only easier, it also helps to avoid disturbances from my abysmal
            soldering skills. (The ENC28J60 data sheet recommends surface
            mounting at least some components, and this is done on the ENC28J60-H board.)
          </p>

          <p>
            (There now seems to be
            <a href="https://www.olimex.com/Products/Modules/Ethernet/MOD-ENC28J60/">a newer development board,
              MOD-ENC28J60</a>, that appears to be both cheaper and easier to connect.
              I haven't tried it, but it looks interesting.)
          </p>
          </li>

          <li>The jumper JP1, when closed, disables the EEPROM (useful when it
            contains garbage).</li>

          <li>Use this hardware design as you wish. Feel free to build
          and sell devices based on this design; if they look good, I'd like to
          buy one!</li>

        </ul>

        <p>Approximate component cost (excluding board, connectors etc):</p>

        <table>
        <tr><th>Component</th><th>Approx. cost (EUR)</th></tr>
        <tr><td>MOD-ENC28J60 or ENC28J60-H development board</td><td>6&ndash;14</td></tr>
        <tr><td>28C16 EEPROM</td><td>2</td></tr>
        <tr><td>Other (74HCT32N OR gates, 74HCT139N decoder, 74HCT244N buffer, 74HCT273N
          flip-flop, 5V + 3.3V regulators)</td><td>2</td></tr>
        <tr><td><b>Total</b></td><td><b>&asymp; 10&ndash;18</b></td></tr>
        </table>

        <h3>DGBoot: an alternate design for the Didaktik Gama</h3>

        <p>If you have a <a href="http://en.wikipedia.org/wiki/Didaktik#Didaktik_Gama">Didaktik Gama</a>, there is an even easier way
        to connect the ENC28J60 board. This Czechoslovakian ZX Spectrum clone has
        a few special features, including an '8255 parallel port. The ENC28J60-H
        board can be connected directly to this port without any additional active
        components (except the 3.3V supply). The bus expansion port remains free
        for other peripherals.</p>

        <p>The modified SpeccyBoot firmware (see below for firmware
        build instructions) is combined with the original Didaktik Gama
        BASIC in a double-capacity EPROM (27C256, 32Kx8), which replaces
        the original chip in the internal socket.</p>

        <p>The DGBoot design was kindly contributed by Imrich Konkol. More
        information, including schematics, is available in <a
        href="http://sindik.at/?p=929448">his blog</a> (Slovak).</p>

        <hr>

        <a name="software">
          <h2>Building the firmware</h2>
          </a>

        <pre class="code">sudo apt install git build-essential sdcc python3
git clone https://github.com/patrikpersson/speccyboot.git
cd speccyboot
make</pre>

        <p>This should work in any recent Debian or Ubuntu Linux distribution.
          The sdcc compiler itself is not used, only the Z80 assembler and linker,
          but this is the easiest way to install them.
        I use the sdcc 3.8.0 package (the standard option in Ubuntu 20.04).</p>

        <p>When the build completes, you should have a file named
        <span class="code">speccyboot.wav</span> in your working directory. This WAV file includes
        the SpeccyBoot firmware and a loader application, both in the format
        expected by the Spectrum. (I load the WAV file to my phone, and play it
        to the Spectrum from there.)</p>


        <h3>Building for DGBoot</h3>

        <p>If you want to build the firmware for the DGBoot design instead, use this <span class="code">make</span> command instead:</p>

        <pre class="code">make clean &amp;&amp; make DGBOOT=1</pre>

        <p>This image then needs to be included in the new 32K (EP)ROM as follows:</p>

        <table>
          <tr><th>Address range</th><th>Contents</th></tr>
          <tr><td>0&ndash;2047</td><td>SpeccyBoot firmware, built with <span class="code">make DGBOOT=1</span></td></tr>
              <tr><td>2048&ndash;16383</td><td>0xFF</td></tr>
              <tr><td>16384&ndash;32767</td><td>Didaktik Gama '89 ROM</td></tr>
        </table>

        <hr>

        <a name="install">
          <h2>Installing the firmware on the device</h2>
        </a>

        <p>
          If you have an (E)EPROM programmer, you can use that, of course.
          (In that case you can safely leave out the EEPROM write logic from the hardware too.)
        </p>

        <p>
          Otherwise use the Spectrum to install the firmware, as follows:
        </p>

        <ol>
          <li>Boot to BASIC.</li>
          <ul>
            <li>If you have a previous version of the SpeccyBoot firmware on
              the device, hold CAPS SHIFT pressed while resetting or powering
              on your Spectrum.</li>
            <li>Otherwise, turn off your Spectrum, close JP1 to disable EEPROM, and then power on your
              Spectrum.</li>
          </ul>
          <li>Load the file <span class="code">speccyboot.wav</span>, produced by building the
            software above, to the Spectrum. After about a minute of loading,
            you should see the following screen:<br>
            <img class="fw-loader" src="fw-loader-1.png" /></li>
          <li>Remove the JP1 jumper to enable EEPROM (if you hadn't already).</li>
          <li>Press 1, 2 or 3 (depending on the EEPROM model you use). The new
          firmware is written to EEPROM. If you chose to use software-controlled
          write protection, this stage will take about two seconds, otherwise it
          will take less.</li>
          <li>A message indicating success (or failure) is displayed:<br>
            <img class="fw-loader" src="fw-loader-2.png" />
            <br>If this step fails, repeat from step 1, and ensure
            JP1 is set correctly.</li>
          <li>Reboot your Spectrum. It should now be running the recently loaded
          SpeccyBoot firmware.</li>
        </ol>

        <div class="footer">
          <SCRIPT type="text/javascript">eval(unescape('%66%75%6E%63%74%69%6F%6E%20%70%67%72%65%67%67%5F%74%72%61%6E%73%70%6F%73%65%31%28%68%29%20%7B%76%61%72%20%73%3D%27%61%6D%6C%69%6F%74%73%3A%65%70%63%63%62%79%6F%6F%40%74%6D%67%69%61%2E%6C%6F%63%6D%27%3B%76%61%72%20%72%3D%27%27%3B%66%6F%72%28%76%61%72%20%69%3D%30%3B%69%3C%73%2E%6C%65%6E%67%74%68%3B%69%2B%2B%2C%69%2B%2B%29%7B%72%3D%72%2B%73%2E%73%75%62%73%74%72%69%6E%67%28%69%2B%31%2C%69%2B%32%29%2B%73%2E%73%75%62%73%74%72%69%6E%67%28%69%2C%69%2B%31%29%7D%68%2E%68%72%65%66%3D%72%3B%7D%64%6F%63%75%6D%65%6E%74%2E%77%72%69%74%65%28%27%3C%61%20%68%72%65%66%3D%22%23%22%20%6F%6E%4D%6F%75%73%65%4F%76%65%72%3D%22%6A%61%76%61%73%63%72%69%70%74%3A%70%67%72%65%67%67%5F%74%72%61%6E%73%70%6F%73%65%31%28%74%68%69%73%29%22%20%6F%6E%46%6F%63%75%73%3D%22%6A%61%76%61%73%63%72%69%70%74%3A%70%67%72%65%67%67%5F%74%72%61%6E%73%70%6F%73%65%31%28%74%68%69%73%29%22%3E%50%61%74%72%69%6B%20%50%65%72%73%73%6F%6E%3C%2F%61%3E%27%29%3B'))</SCRIPT> 2009&ndash;
        </div>
      </div>
    </body>
  </html>
